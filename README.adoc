= 3 05 Activity 1 to 3
:stylesheet: boot-darkly.css
:linkcss: boot-darkly.css
:image-url-ironhack: https://user-images.githubusercontent.com/23629340/40541063-a07a0a8a-601a-11e8-91b5-2f13e4e6b441.png
:my-name: Jorge Castro DAPT NOV2021
:description: SQL queries Activities
//:script-url: ADD SCRIPT URL HERE 
:toc:
:toc-title: Activities | Description: Keep working on the bank database.
:toc-placement!:
:toclevels: 5
//:fn-xxx: Add the explanation foot note here bla bla
ifdef::env-github[]
:sectnums:
:tip-caption: :bulb:
:note-caption: :information_source:
:important-caption: :heavy_exclamation_mark:
:caution-caption: :fire:
:warning-caption: :warning:
:experimental:
:table-caption!:
:example-caption!:
:figure-caption!:
:idprefix:
:idseparator: -
:linkattrs:
:fontawesome-ref: http://fortawesome.github.io/Font-Awesome
:icon-inline: {user-ref}/#inline-icons
:icon-attribute: {user-ref}/#size-rotate-and-flip
:video-ref: {user-ref}/#video
:checklist-ref: {user-ref}/#checklists
:list-marker: {user-ref}/#custom-markers
:list-number: {user-ref}/#numbering-styles
:imagesdir-ref: {user-ref}/#imagesdir
:image-attributes: {user-ref}/#put-images-in-their-place
:toc-ref: {user-ref}/#table-of-contents
:para-ref: {user-ref}/#paragraph
:literal-ref: {user-ref}/#literal-text-and-blocks
:admon-ref: {user-ref}/#admonition
:bold-ref: {user-ref}/#bold-and-italic
:quote-ref: {user-ref}/#quotation-marks-and-apostrophes
:sub-ref: {user-ref}/#subscript-and-superscript
:mono-ref: {user-ref}/#monospace
:css-ref: {user-ref}/#custom-styling-with-attributes
:pass-ref: {user-ref}/#passthrough-macros
endif::[]
ifndef::env-github[]
:imagesdir: ./
endif::[]

image::{image-url-ironhack}[width=70]

{my-name}


                                                     
====
''''
====
{description}

toc::[]



== Activity:

=== Find out the average number of transactions by account. Get those accounts that have more transactions than the average.

`*_Answer:_*`

```sql
CREATE TEMPORARY TABLE avg_count_trans
SELECT
    avg(avg_no_of_transactions_by_account) AS avg_count_trans
FROM
    (
        SELECT
            (
                SELECT
                    avg(count(account_id))
            ) AS avg_no_of_transactions_by_account
        FROM
            trans
        GROUP BY
            account_id
    ) AS t;
```

image::https://user-images.githubusercontent.com/63274055/151272176-8d4bdeb2-53ed-4b35-9309-739d93eb8e0b.png[width=600]

```sql
SELECT
    account_id,
    (
        SELECT
            floor(avg(count(account_id)))
    ) AS equal_and_less_than_avg
FROM
    trans
GROUP BY
    1
HAVING
    equal_and_less_than_avg <= (
        SELECT
            *
        FROM
            avg_count_trans
    )
ORDER BY
    2 DESC;
```
image::https://user-images.githubusercontent.com/63274055/151272367-3a368f8e-cd88-4b60-a38a-31d3758cb03d.png[width=600]
```sql
SELECT
    account_id,
    (
        SELECT
            floor(avg(count(account_id)))
    ) AS no_trans_above_avg
FROM
    trans
GROUP BY
    1
HAVING
    no_trans_above_avg > (
        SELECT
            *
        FROM
            avg_count_trans
    )
ORDER BY
    2 DESC;
```

image::https://user-images.githubusercontent.com/63274055/151272521-e060de56-ee1a-4479-bbff-05969254e7a1.png[width=600]

_First I calculate the average number of transactions by account, then calculate the total average which is 192. I have separated the output into accounts with a number of transactions equal or below average and accounts with a number of transactions above average. If I display only the average number of transactions by account the output would be an averages per account from 6 to 548. This would have been redundant as the second part of the question asked me to display accounts that have more transactions than the average. And the total average of transactions is 192._

== Activity:

=== Get a list of accounts from Central Bohemia using a subquery.

* Rewrite the previous as a join query.

* Discuss which method will be more efficient.

== Activity:

=== Find the most active customer for each district in Central Bohemia.

====
''''
====


{script-url}[Solutions script only]

====
''''
====

//bla bla blafootnote:[{fn-xxx}]

xref:3-05-Activity-1-to-3[Top Section]

xref:Last-section[Bottom section]


////
.Unordered list title
* gagagagagaga
** gagagatrtrtrzezeze
*** zreu fhjdf hdrfj 
*** hfbvbbvtrtrttrhc
* rtez uezrue rjek  

.Ordered list title
. rwieuzr skjdhf
.. weurthg kjhfdsk skhjdgf
. djhfgsk skjdhfgs 
.. lksjhfgkls ljdfhgkd
... kjhfks sldfkjsdlk




[,sql]
----
----



[NOTE]
====
A sample note admonition.
====
 
TIP: It works!
 
IMPORTANT: Asciidoctor is awesome, don't forget!
 
CAUTION: Don't forget to add the `...-caption` document attributes in the header of the document on GitHub.
 
WARNING: You have no reason not to use Asciidoctor.

bla bla bla the 1NF or first normal form.footnote:[{1nf}]Then wen bla bla


====
- [*] checked
- [x] also checked
- [ ] not checked
-     normal list item
====
[horizontal]
CPU:: The brain of the computer.
Hard drive:: Permanent storage for operating system and/or user files.
RAM:: Temporarily stores information the CPU uses during operation.






bold *constrained* & **un**constrained

italic _constrained_ & __un__constrained

bold italic *_constrained_* & **__un__**constrained

monospace `constrained` & ``un``constrained

monospace bold `*constrained*` & ``**un**``constrained

monospace italic `_constrained_` & ``__un__``constrained

monospace bold italic `*_constrained_*` & ``**__un__**``constrained

////
